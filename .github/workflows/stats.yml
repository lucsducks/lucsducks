name: Actualizar estadísticas

on:
  push:
    branches: [main, master]
  schedule:
    - cron: "0 3 * * *"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4

      - name: Generar stats
        uses: readme-tools/github-readme-stats-action@v1
        with:
          card: stats
          options: username=lucsducks&show_icons=true&hide_border=true&border_radius=8&locale=es&bg_color=0d1117&title_color=c9d1d9&icon_color=8b949e&text_color=8b949e&custom_title=Estadísticas+de+GitHub
          path: profile/stats.svg
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Generar top-langs
        uses: readme-tools/github-readme-stats-action@v1
        with:
          card: top-langs
          options: username=lucsducks&layout=compact&hide_border=true&border_radius=8&locale=es&bg_color=0d1117&title_color=c9d1d9&text_color=8b949e
          path: profile/top-langs.svg
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Descargar streak stats
        run: |
          mkdir -p profile
          curl -fsSL -o profile/streak.svg "https://streak-stats.demolab.com/?user=lucsducks&theme=dark&hide_border=true&border_radius=8&locale=es&date_format=M%20j%5B%2C%20Y%5D&mode=weekly&background=0d1117&stroke=6e7681&fire=8b949e&currStreakNum=c9d1d9&sideNums=8b949e&currStreakLabel=6e7681&sideLabels=6e7681"
        continue-on-error: true

      - name: Descargar trophies
        run: |
          mkdir -p profile
          curl -fsSL -o profile/trophies.svg "https://github-profile-trophy.vercel.app/?username=lucsducks&theme=onedark&no-frame=true&no-bg=true&column=3&margin-w=10"
        continue-on-error: true

      - name: Commit
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add profile/
          git diff --staged --quiet || (git commit -m "Actualizar estadísticas" && git push)
